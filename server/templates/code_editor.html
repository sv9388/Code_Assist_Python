{% extends "layout.html" %}

{% block title %}Generate{% endblock %}

{% block header_content %}
        <a href="{{url_for('logout')}}" class="btn btn-info" role="button">  Logout  </a>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename = 'codemirror-5.25.0/lib/codemirror.css') }}">
<script src="{{ url_for('static', filename = 'codemirror-5.25.0/lib/codemirror.js') }}"></script>
<script src="{{ url_for('static', filename = 'codemirror-5.25.0/addon/edit/matchingbrackets.js') }}"></script>
<script src="{{ url_for('static', filename = 'codemirror-5.25.0/mode/python/python.js') }}"></script>
<style type="text/css">.ValueMirror {border-top: 1px solid black; border-bottom: 1px solid black;}</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>


<div class="container">
	<div class="row">
		<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
			<div class="panel panel-default"  onLoad="text_editor();">
				<div class="panel-heading">
					<button type="button" style="display: none" id = 'inv_b' data-val="bold" class="btn btn-default" data-loading-text="Generating Value. Please wait..." > Generate Value </button>
				</div>
				<div class="panel-body">
					<textarea id="text-editor" name="text-editor" rows = 20 class="form-control">{{full_code}}</textarea>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
			<div id="question-iframe"></div>
		</div>
	</div>
</div>

<script type = "text/javascript">
	var editor = document.getElementById('text-editor');
	$("#text-editor").each(function (i) {
          editor = CodeMirror.fromTextArea(this, {
       	    mode: {name: "python",
            version: 3,
            singleLineStringErrors: false},
            lineNumbers: true,
            indentUnit: 4,
            matchBrackets: true,
            extraKeys: {"Shift-Enter" : function(){
			document.getElementById("inv_b").click();
		}}
	  });
        });
$('#inv_b').click(function(){
			$.post("{{url_for('code_editor')}}", 
					{ ip_str    :    editor.getLine(editor.getCursor().line),
					  tab_w     :    "    ",
					  src_code_content : editor.getValue()
					},
					function(data, status){
						if (data["errors"].length > 0){
							console.log(data["errors"]+" "+$("#opfl").html());
							$("#opfl").html("<div class=\"alert alert-danger alert-dismissable\">\n<a class=\"close\" data-dismiss=\"alert\" aria-label=\"close\" href=\"#\">×</a>\n" + data["errors"]+"\n</div>");
						}
						else{
							$("#opfl").html("<div class=\"alert alert-success alert-dismissable\">\n<a class=\"close\" data-dismiss=\"alert\" aria-label=\"close\" href=\"#\">×</a>\n  So far so good!\n</div>"); 
							editor.setValue(data["full_code"]);
						}
					});
			});
</script>
{% endblock %}
